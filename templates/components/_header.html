<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        {% block title %}{{ request.app.title }}{% endblock %}
    </title>
    <!-- CRITICAL: Apply theme IMMEDIATELY to prevent white flash on dark mode -->
    <!-- This must run BEFORE any stylesheets load to set the class before first paint -->
    <script>
        (function() {
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>
    <!-- Critical inline styles to prevent background flash during theme load -->
    <style>
        html { background-color: #f9fafb; } /* gray-50 - light mode default */
        html.dark { background-color: #111827; } /* gray-900 - dark mode */
        body { background-color: inherit; margin: 0; }
    </style>
    <!-- Preconnect to CDNs for faster resource loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Favicon and Icons -->
    <link rel="icon" href="/static/icons/favicon.ico" sizes="any">
    <link rel="icon"
          href="/static/icons/favicon-16x16.png"
          sizes="16x16"
          type="image/png">
    <link rel="icon"
          href="/static/icons/favicon-32x32.png"
          sizes="32x32"
          type="image/png">
    <link rel="apple-touch-icon"
          href="/static/icons/apple-touch-icon.png"
          sizes="180x180">
    <link rel="manifest" href="/static/icons/site.webmanifest">
    <meta name="theme-color" content="#ffffff">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
          rel="stylesheet">
    <!-- Font Awesome Pro (local) -->
    <link rel="stylesheet" href="/static/icons/font-awesome/css/all.min.css">
    <!-- CRITICAL: Load CSS BEFORE scripts to prevent FOUC (Flash of Unstyled Content) -->
    <!-- This ensures styles are applied before Alpine.js initializes components -->
    <link rel="stylesheet" href="/static/css/output.css">
    <link rel="stylesheet" href="/static/style.css" />
    <!-- Axios for AJAX calls -->
    <script defer src="/static/js/axios.min.js"></script>
    <!-- Data Grid Component (load before Alpine) -->
    <script defer src="/static/js/datagrid.js"></script>
    <!-- Toast Component (load before Alpine) -->
    <script defer src="/static/js/toast.js"></script>
    <!-- Alpine Plugins -->
    <script defer src="/static/js/alpine-mask.js"></script>
    <script defer src="/static/js/alpine-collapse.js"></script>
    <script defer src="/static/js/alpine-focus.js"></script>
    <!-- Global initialization and utilities (MUST load BEFORE Alpine.js for resizableSidebar) -->
    <script defer src="/static/js/global-init.js"></script>
    <!-- Alpine.js Core for reactive components (load last, after global-init) -->
    <script defer src="/static/js/alpine-min.js"></script>
    <!-- i18n translations for datagrid and toast components (MUST run BEFORE Alpine init) -->
    <script>
    window.datagridI18n = {
        valueGreaterEqual: "{{ _('Value must be greater than or equal to {0}') }}",
        valueGreater: "{{ _('Value must be greater than {0}') }}",
        valueLessEqual: "{{ _('Value must be less than or equal to {0}') }}",
        valueLess: "{{ _('Value must be less than {0}') }}",
        fieldRequired: "{{ _('This field is required') }}",
        validNumber: "{{ _('Must be a valid number') }}",
        validInteger: "{{ _('Must be a valid integer') }}",
        minLength: "{{ _('Must be at least {0} character(s)') }}",
        maxLength: "{{ _('Must be at most {0} character(s)') }}",
        validText: "{{ _('Must be a valid text') }}",
        invalidValue: "{{ _('Invalid value') }}",
        fixErrors: "{{ _('Please fix the validation errors below.') }}",
        recordAddSuccess: "{{ _('Record added successfully') }}",
        recordUpdateSuccess: "{{ _('Record updated successfully') }}",
        recordDeleteSuccess: "{{ _('Record deleted successfully') }}",
        recordAddFailed: "{{ _('Failed to add record') }}",
        recordUpdateFailed: "{{ _('Failed to update record') }}",
        recordDeleteFailed: "{{ _('Failed to delete record') }}",
        networkError: "{{ _('Network error - no response from server') }}",
        unknownError: "{{ _('Unknown error occurred') }}",
        validationError: "{{ _('Validation error') }}",
        toastClose: "{{ _('Close') }}"
    };
    </script>
    {% block extra_head %}{% endblock %}
</head>
